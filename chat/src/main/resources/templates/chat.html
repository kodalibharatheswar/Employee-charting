<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Chat</title>
    <link rel="stylesheet" th:href="@{/css/chat.css}">
</head>
<body>
<div class="chat-container">
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>Employee Chat</h2>
            <div class="user-info">
                <span class="user-name" th:text="${currentUser.fullName}"></span>
                <span class="user-status online">●</span>
            </div>
            <!-- Fixed logout to use POST form -->
            <form th:action="@{/logout}" method="post" style="display: inline; margin: 0;">
                <button type="submit" class="btn-logout">Logout</button>
            </form>
        </div>

        <!-- Tabs for Direct & Group Chat -->
        <div class="chat-tabs">
            <button class="tab-btn active" data-tab="direct">Direct Messages</button>
            <button class="tab-btn" data-tab="groups">Groups</button>
        </div>

        <!-- Direct Messages List -->
        <div class="chat-list" id="direct-list">
            <div class="list-header">
                <h3>Conversations</h3>
                <button class="btn-new-chat" id="btn-new-direct">+</button>
            </div>
            <div id="conversation-list" class="chat-items"></div>
        </div>

        <!-- Group Chat List -->
        <div class="chat-list hidden" id="groups-list">
            <div class="list-header">
                <h3>Chat Rooms</h3>
                <button class="btn-new-chat" id="btn-new-group">+</button>
            </div>
            <div id="chatroom-list" class="chat-items"></div>
        </div>
    </div>

    <!-- Main Chat Area -->
    <div class="main-chat">
        <div class="welcome-screen" id="welcome-screen">
            <h2>Welcome to Employee Chat!</h2>
            <p>Select a conversation or create a new one to start chatting</p>
        </div>

        <div class="chat-window hidden" id="chat-window">
            <div class="chat-header">
                <div class="chat-header-info">
                    <h3 id="chat-title">Chat Name</h3>
                    <span id="chat-subtitle">Status</span>
                </div>
                <div class="chat-header-actions">
                    <button id="btn-chat-info" title="Chat Info">ℹ️</button>
                    <button id="btn-close-chat" title="Close">✖</button>
                </div>
            </div>

            <div class="messages-container" id="messages-container"></div>

            <div class="typing-indicator hidden" id="typing-indicator">
                <span></span> is typing...
            </div>

            <div class="message-input-container">
                <input type="text" id="message-input" placeholder="Type a message..." />
                <button id="send-button">Send</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal for New Direct Chat -->
<div id="new-direct-modal" class="modal hidden">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Start New Conversation</h2>
        <input type="text" id="search-users" placeholder="Search employees..." />
        <div id="users-list" class="users-list"></div>
    </div>
</div>

<!-- Modal for New Group Chat -->
<div id="new-group-modal" class="modal hidden">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Create Group Chat</h2>
        <div class="form-group">
            <label>Group Name</label>
            <input type="text" id="group-name" placeholder="Enter group name" />
        </div>
        <div class="form-group">
            <label>Description</label>
            <input type="text" id="group-description" placeholder="Enter description (optional)" />
        </div>
        <button id="create-group-btn" class="btn-primary">Create Group</button>
    </div>
</div>

<!-- Hidden fields -->
<input type="hidden" id="currentUserId" th:value="${currentUser.id}" />
<input type="hidden" id="currentUsername" th:value="${currentUser.username}" />

<!-- Scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.6.1/sockjs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
<script th:src="@{/js/chat.js}"></script>
</body>
</html>


