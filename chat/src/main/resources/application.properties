# Application Name
spring.application.name=chat-module

# Server Port
server.port=8080

# MySQL Database Configuration
spring.datasource.url=jdbc:mysql://localhost:3306/crm_chat_db?createDatabaseIfNotExist=true&useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC
spring.datasource.username=root
spring.datasource.password=root
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# JPA/Hibernate Configuration
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.use_sql_comments=true

# Thymeleaf Configuration
spring.thymeleaf.cache=false
spring.thymeleaf.enabled=true
spring.thymeleaf.prefix=classpath:/templates/
spring.thymeleaf.suffix=.html
spring.thymeleaf.mode=HTML
spring.thymeleaf.encoding=UTF-8

# Logging Configuration
logging.level.root=INFO
logging.level.com.crm.chat=DEBUG
logging.level.org.springframework.web=DEBUG
logging.level.org.springframework.security=DEBUG
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE

# File Upload Configuration (for future file sharing feature)
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=50MB
spring.servlet.multipart.max-request-size=50MB
spring.servlet.multipart.file-size-threshold=2KB

# File storage location (customize as needed)
# file.upload-dir=./uploads
# file.max-size=52428800

# Jackson Configuration
#spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.time-zone=UTC
#spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.default-property-inclusion=non_null

# Session Configuration
server.servlet.session.timeout=30m
server.servlet.session.cookie.name=CHAT_SESSION
server.servlet.session.cookie.http-only=true
server.servlet.session.cookie.secure=false
# For production, set cookie.secure=true when using HTTPS
server.servlet.session.cookie.same-site=lax

# WebSocket Configuration
# These are handled in WebSocketConfig.java

# Security Configuration
# These are handled in SecurityConfig.java

# ============================================================================
# WEBSOCKET CONFIGURATION
# ============================================================================
# Most WebSocket settings are in WebSocketConfig.java
# Additional runtime properties can be set here if needed

# WebSocket message size limits (bytes)
spring.websocket.message-size-limit=524288
spring.websocket.send-buffer-size-limit=1048576
spring.websocket.send-time-limit=20000

# ============================================================================
# WEBRTC CONFIGURATION - STUN/TURN SERVERS
# ============================================================================

# -----------------------------------------------------------------------------
# STUN Servers (Session Traversal Utilities for NAT)
# Purpose: Help devices behind NAT/firewalls discover their public IP addresses
# Cost: FREE (using public servers)
# -----------------------------------------------------------------------------

# Primary STUN Server - Google Public STUN
webrtc.stun.server1.url=stun:stun.l.google.com:19302

# Backup STUN Servers (for redundancy)
webrtc.stun.server2.url=stun:stun1.l.google.com:19302
webrtc.stun.server3.url=stun:stun2.l.google.com:19302
webrtc.stun.server4.url=stun:stun3.l.google.com:19302
webrtc.stun.server5.url=stun:stun4.l.google.com:19302

# Alternative Public STUN Servers (optional)
# webrtc.stun.server6.url=stun:stun.services.mozilla.com:3478
# webrtc.stun.server7.url=stun:stun.stunprotocol.org:3478

# -----------------------------------------------------------------------------
# TURN Servers (Traversal Using Relays around NAT)
# Purpose: Relay media when direct P2P connection fails
# Required: For enterprise networks with strict firewalls
# Cost: FREE options available, or self-host with Coturn
# -----------------------------------------------------------------------------

# Option 1: Use Free TURN Server (Limited, for testing only)
# ⚠️ WARNING: Free public TURN servers have bandwidth limits
# For production, use your own TURN server or paid service

# Metered TURN Server (Free tier: 50GB/month)
# Sign up at: https://www.metered.ca/tools/openrelay/
webrtc.turn.server1.url=turn:openrelay.metered.ca:80
webrtc.turn.server1.username=openrelayproject
webrtc.turn.server1.credential=openrelayproject

# Alternative TURN server with TLS
webrtc.turn.server2.url=turns:openrelay.metered.ca:443
webrtc.turn.server2.username=openrelayproject
webrtc.turn.server2.credential=openrelayproject

# Option 2: Self-Hosted TURN Server (Coturn)
# Install: https://github.com/coturn/coturn
# Recommended for production use

# Example self-hosted configuration (uncomment and configure):
# webrtc.turn.server3.url=turn:your-turn-server.com:3478
# webrtc.turn.server3.username=your-username
# webrtc.turn.server3.credential=your-secret-key
# webrtc.turn.server3.credential-type=password

# TURN server with TLS (recommended for production)
# webrtc.turn.server4.url=turns:your-turn-server.com:5349
# webrtc.turn.server4.username=your-username
# webrtc.turn.server4.credential=your-secret-key
# webrtc.turn.server4.credential-type=password

# Option 3: Commercial TURN Service (Twilio, Xirsys, etc.)
# Example with Xirsys (Paid service with free trial)
# Sign up at: https://xirsys.com/

# webrtc.turn.xirsys.url=turn:your-account.xirsys.com:80?transport=udp
# webrtc.turn.xirsys.username=your-username
# webrtc.turn.xirsys.credential=your-api-key

# -----------------------------------------------------------------------------
# WebRTC Call Configuration
# -----------------------------------------------------------------------------

# Maximum participants in a group call
webrtc.call.max-participants=10

# Call timeout settings (milliseconds)
webrtc.call.ring-timeout=45000
webrtc.call.connect-timeout=30000
webrtc.call.idle-timeout=300000

# Audio/Video quality settings
webrtc.video.max-width=1280
webrtc.video.max-height=720
webrtc.video.max-framerate=30
webrtc.audio.echo-cancellation=true
webrtc.audio.noise-suppression=true
webrtc.audio.auto-gain-control=true

# Screen sharing settings
webrtc.screenshare.max-width=1920
webrtc.screenshare.max-height=1080
webrtc.screenshare.max-framerate=15

# Call recording (if implemented)
# webrtc.recording.enabled=false
# webrtc.recording.storage-path=./recordings

# -----------------------------------------------------------------------------
# ICE Configuration
# -----------------------------------------------------------------------------

# ICE gathering timeout (milliseconds)
webrtc.ice.gathering-timeout=5000

# ICE candidate pool size (number of candidates to gather in advance)
webrtc.ice.candidate-pool-size=10

# ICE transport policy
# Options: all, relay (force TURN usage)
webrtc.ice.transport-policy=all

# ============================================================================
# SECURITY CONFIGURATION
# ============================================================================
# Most security settings are in SecurityConfig.java

# CORS allowed origins (for production, specify exact domains)
# cors.allowed-origins=https://yourdomain.com,https://app.yourdomain.com

# ============================================================================
# ACTUATOR & MONITORING (Optional - for production)
# ============================================================================
# Uncomment to enable Spring Boot Actuator for health checks and metrics

# management.endpoints.web.exposure.include=health,info,metrics
# management.endpoint.health.show-details=when-authorized
# management.metrics.export.prometheus.enabled=true

# ============================================================================
# PRODUCTION SETTINGS
# ============================================================================
# Uncomment and configure for production deployment

# Server Configuration
# server.address=0.0.0.0
# server.compression.enabled=true
# server.http2.enabled=true

# SSL/TLS Configuration (for HTTPS)
# server.ssl.enabled=true
# server.ssl.key-store=classpath:keystore.p12
# server.ssl.key-store-password=your-password
# server.ssl.key-store-type=PKCS12
# server.ssl.key-alias=tomcat

# Production Database (use environment variables)
# spring.datasource.url=${DB_URL}
# spring.datasource.username=${DB_USERNAME}
# spring.datasource.password=${DB_PASSWORD}

# Production Logging
# logging.level.root=WARN
# logging.level.com.crm.chat=INFO
# logging.file.name=logs/chat-application.log





# STUN vs TURN:
# ---------------
# STUN: Discovers public IP, works for ~80% of connections
# TURN: Relays media when direct connection fails, works 100% but uses bandwidth
# 
# Recommendation:
# - Development: Use free Google STUN servers (provided above)
# - Production: Add TURN server for reliability
#   * Self-host Coturn (free, unlimited)
#   * Use Metered/Xirsys (paid, managed)
#
# Setting up Coturn (Self-hosted TURN):
# -------------------------------------
# 1. Install: sudo apt-get install coturn
# 2. Configure: /etc/turnserver.conf
# 3. Enable: sudo systemctl enable coturn
# 4. Start: sudo systemctl start coturn
# 5. Update properties above with your server details
#
# Cost Comparison:
# ---------------
# Option                 | Cost          | Reliability | Setup
# -----------------------|---------------|-------------|-------
# Google STUN (free)     | $0            | 70-80%      | 0 min
# + Metered TURN (free)  | $0 (50GB/mo)  | 95%         | 5 min
# Self-hosted Coturn     | Server cost   | 99%         | 30 min
# Twilio/Xirsys          | $0.004/min    | 99.9%       | 10 min
#
# For internal CRM use with <100 concurrent calls:
# → Google STUN + Metered TURN (free) is perfect!

# ============================================================================
# END OF CONFIGURATION
# ===================